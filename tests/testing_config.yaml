---
defaults:
    - ../bliss/conf@_here_: base_config
    - _self_
    - override hydra/job_logging: stdout

simulator:
    valid_n_batches: 6
    n_batches: 2
    num_workers: 0
    sdss_fields:
        dir: ${paths.sdss}
        bands: [0, 1, 2, 3, 4]
        field_list:  # list of dictionaries, each with run, camcol, and list of fields
          - run: 94
            camcol: 1
            fields: [12]
    prior:
        n_tiles_h: 8
        n_tiles_w: 8
        batch_size: 32
        prob_galaxy: 0.5
        star_flux_min: 1e5
    # background:
    #     _target_: bliss.simulator.background.SimulatedSDSSBackground
    #     sdss_fields: ${simulator.sdss_fields}

cached_simulator:
    num_workers: 0
    train_n_batches: 1
    val_split_file_idxs: [1]
    test_split_file_idxs: [2]

generate:
    n_batches: 3
    batch_size: 8
    max_images_per_file: 8
    cached_data_path: null # use pytest tmpdir

training:
    name: "pytest_encoder"
    version: "version0"
    n_epochs: 1
    enable_early_stopping: true
    pretrained_weights: ${paths.pretrained_models}/zscore_five_band.pt
    seed: 42
    weight_save_path: null
    trainer:
        logger: false
        enable_checkpointing: true
        profiler: null
        check_val_every_n_epoch: 1001
        log_every_n_steps: 1
        accelerator: "cpu"
        devices: 1

predict:
    decals_frame: ${paths.decals}/tractor-3366m010.fits
    weight_save_path: ${paths.pretrained_models}/zscore_five_band.pt
    device: "cpu"
    crop:
        left_upper_corner: [160, 160]
        width: 160
        height: 160
    plot:
        show_plot: false
