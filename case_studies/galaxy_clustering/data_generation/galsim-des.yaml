# This file uses GalSim to generate image data from catalogs of galaxy clusters
# Can be called directly from the command line using galsim galsim-des.yaml
# Inputs are catalogs (stored as .dat files) in the /catalogs/ directory
# Outputs are corresponding .fits files stored in the /galsim_des_data/ directory
# Catalog Columns:
#   0: RA
#   1: DEC
#   2: X
#   3: Y
#   4: MEM
#   5: FLUX_G
#   6: FLUX_R
#   7: FLUX_I
#   8: FLUX_Z
#   9: HLR
#   10: FRACDEV
#   11: G1
#   12: G2
#   13: Z
#   14: SOURCE_TYPE
#   15: GI_COLOR
#   16: IZ_COLOR

variables :
  nfiles : 100
  image_size: 1280
  input_dir : /nfs/turbo/lsa-regier/scratch/kapnadak/new_data_2/catalogs
  output_dir : /nfs/turbo/lsa-regier/scratch/kapnadak/new_data_2/images

modules :
  - galsim.des

psf :
  type : DES_PSFEx

image :

  nproc : 32
  type : Scattered
  pixel_scale : 0.263
  xsize : '@variables.image_size'
  ysize : '@variables.image_size'

  random_seed : 8241573

  gsparams :
    maximum_fft_size : 50000

  noise:
    type: Gaussian
    variance:
      type: Random
      min: 0.002
      max: 0.006

stamp :

  draw_method : fft

  image_pos :
    type : XY
    x : { type: Catalog, col: 2 }
    y : { type: Catalog, col: 3 }

input :
  catalog :
    dir : '@variables.input_dir'
    file_name :
      type : FormattedStr
      format : "galsim_des_%03d.dat"
      items :
      - { type : Sequence, nitems : '@variables.nfiles'}

---

gal :

  type : Gaussian
  half_light_radius : { type: Catalog, col: 9 }
  flux : { type: Catalog, col: 5 } #using G band

  shear :
    type : G1G2
    g1 : { type: Catalog, col: 11 }
    g2 : { type: Catalog, col: 12 }

input :
  des_psfex:
    dir : '/nfs/turbo/lsa-regier/scratch/gapatron/psf-models/dr2_tiles_reformatted/gband'
    file_name:
      type : FormattedStr
      format : "galsim_des_%03d_g.psf"
      items :
        - {type : Sequence, nitems: '@variables.nfiles'}

output :
  type : Fits
  dir : '@variables.output_dir'
  file_name :
    type : FormattedStr
    format : "galsim_des_%03d_g.fits"
    items :
    - { type : Sequence, nitems: '@variables.nfiles'}

  nfiles : '@variables.nfiles'

---

gal :

  type : Gaussian
  half_light_radius : { type: Catalog, col: 9 }
  flux : { type: Catalog, col: 6 } #using R band

  shear :
    type : G1G2
    g1 : { type: Catalog, col: 11 }
    g2 : { type: Catalog, col: 12 }

input :
  des_psfex:
    dir : '/nfs/turbo/lsa-regier/scratch/gapatron/psf-models/dr2_tiles_reformatted/rband'
    file_name:
      type : FormattedStr
      format : "galsim_des_%03d_r.psf"
      items :
        - {type : Sequence, nitems: '@variables.nfiles'}

output :
  type : Fits
  dir : '@variables.output_dir'
  file_name :
    type : FormattedStr
    format : "galsim_des_%03d_r.fits"
    items :
    - { type : Sequence, nitems: '@variables.nfiles'}

  nfiles : '@variables.nfiles'

---

gal :

  type : Gaussian
  half_light_radius : { type: Catalog, col: 9 }
  flux : { type: Catalog, col: 7 } #using I band

  shear :
    type : G1G2
    g1 : { type: Catalog, col: 11 }
    g2 : { type: Catalog, col: 12 }

input :
  des_psfex:
    dir : '/nfs/turbo/lsa-regier/scratch/gapatron/psf-models/dr2_tiles_reformatted/iband'
    file_name:
      type : FormattedStr
      format : "galsim_des_%03d_i.psf"
      items :
        - {type : Sequence, nitems: '@variables.nfiles'}

output :
  type : Fits
  dir : '@variables.output_dir'
  file_name :
    type : FormattedStr
    format : "galsim_des_%03d_i.fits"
    items :
    - { type : Sequence, nitems: '@variables.nfiles'}

  nfiles : '@variables.nfiles'

---

gal :

  type : Gaussian
  half_light_radius : { type: Catalog, col: 9 }
  flux : { type: Catalog, col: 8 } #using Z band

  shear :
    type : G1G2
    g1 : { type: Catalog, col: 11 }
    g2 : { type: Catalog, col: 12 }

input :
  des_psfex:
    dir : '/nfs/turbo/lsa-regier/scratch/gapatron/psf-models/dr2_tiles_reformatted/zband'
    file_name:
      type : FormattedStr
      format : "galsim_des_%03d_z.psf"
      items :
        - {type : Sequence, nitems: '@variables.nfiles'}

output :
  type : Fits
  dir : '@variables.output_dir'
  file_name :
    type : FormattedStr
    format : "galsim_des_%03d_z.fits"
    items :
    - { type : Sequence, nitems: '@variables.nfiles'}

  nfiles : '@variables.nfiles'
