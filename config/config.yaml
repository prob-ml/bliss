defaults:
  - _self_
  - optimizer: adam
  - model: sleep_star_basic
  - dataset: default
  - training: sdss_autoencoder
  - testing: default
  - generate: default
  - optional tuning: ${model}
  - predict: sdss
  - override hydra/job_logging: stdout

# completely disable hydra logging
# https://github.com/facebookresearch/hydra/issues/910
hydra:
  output_subdir: null
  run:
    dir: .

mode: train

gpus: 1 # use a single gpu by default.

paths:
  root: ${oc.env:BLISS_HOME}
  output: ${paths.root}/output
  sdss: ${paths.root}/data/sdss
  data: ${paths.root}/data

datasets:
    binary:
        _target_: bliss.datasets.simulated.SimulatedDataset
        decoder: ${models.decoder}
        prior: ${models.prior}
        n_batches: 10
        batch_size: 32
        generate_device: "cuda:0"
        testing_file: null
    sdss_galaxies:
        _target_: bliss.datasets.galsim_galaxies.SDSSGalaxies
        num_workers: 0
        batch_size: 64
        n_batches: 10
        background: 865
        noise_factor: 0.01
        slen: 53
        min_flux: 1e3
        max_flux: 3.5e5
        min_a_d: 0.8
        max_a_d: 6.5
        min_a_b: 0.8
        max_a_b: 3.6 # from catalog with mag < 22.2 cut.
        flux_sample: "uniform"
        psf_image_file: data/psField-000094-1-0012-PSF-image.npy

models:
    binary:
        _target_: bliss.models.binary.BinaryEncoder
        n_bands: 1
        tile_slen: 4
        ptile_slen: 52
        channel: 8
        hidden: 128
        spatial_dropout: 0.0
        dropout: 0.0
    decoder:
        n_bands: 1
        slen: 40
        tile_slen: 4
        ptile_slen: 52
        border_padding: 24
        psf_params_file: data/sdss/94/1/12/psField-000094-1-0012.fits
        prob_galaxy: 0.7
        autoencoder_ckpt: models/sdss_autoencoder.ckpt
        background_values:
          - 865.0
        sdss_bands:
          - 2
    galaxy_encoder:
        _target_: bliss.models.galaxy_encoder.GalaxyEncoder
    galaxy_net:
        _target_: bliss.models.galaxy_net.OneCenteredGalaxyAE
        slen: 53
        latent_dim: 64
        n_bands: 1
        residual_delay_n_steps: 500
    prior: 
        n_bands: 1
        slen: 40
        tile_slen: 4
        max_sources: 1
        mean_sources: 0.03
        min_sources: 0
        f_min: 1e3
        f_max: 1e6
        alpha: 0.5
        prob_galaxy: 0.7
        autoencoder_ckpt: models/sdss_autoencoder.ckpt
        latents_file: data/latents_simulated_sdss_galaxies.pt
    sleep:
        _target_: bliss.models.SleepPhase

optimizers:
    adam:
        name: Adam
        kwargs:
          lr: 1e-3
          weight_decay: 0

